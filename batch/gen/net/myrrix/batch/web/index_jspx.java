/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: JspCServletContext/1.0
 * Generated at: 2013-08-06 20:46:12 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package net.myrrix.batch.web;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;
import net.myrrix.store.Store;
import net.myrrix.batch.PeriodicRunner;
import net.myrrix.batch.GenerationState;
import net.myrrix.batch.MyrrixStepState;
import net.myrrix.batch.MyrrixStepStatus;
import net.myrrix.batch.PeriodicRunnerState;
import java.net.URI;
import java.text.DateFormat;
import java.text.NumberFormat;
import java.util.Date;
import java.util.regex.Pattern;

public final class index_jspx extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent {


private static final Pattern COMMA = Pattern.compile(",");
private static String formatShort(Date date) {
  return date == null ? "" : DateFormat.getDateTimeInstance(DateFormat.SHORT, DateFormat.SHORT).format(date);
}
private static String formatPercent(float pct) {
  return Float.isNaN(pct) ? "0%" : NumberFormat.getPercentInstance().format(pct);
}
private static String getHexColor(MyrrixStepStatus status) {
  switch (status) {
    case COMPLETED:
      return "green";
    case FAILED:
      return "red";
    case CANCELLED:
      return "yellow";
    default:
      return "white";
  }
}

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private javax.el.ExpressionFactory _el_expressionfactory;
  private org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public void _jspInit() {
    _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
    _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
  }

  public void _jspDestroy() {
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
        throws java.io.IOException, javax.servlet.ServletException {

    final javax.servlet.jsp.PageContext pageContext;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html;charset=UTF-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, false, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("<!DOCTYPE html>");
      out.write("<html>");
      out.write("<!-- Copyright Myrrix. See myrrix.com/legal for license. -->");
      out.write("<head>");
      out.write("<title>");
      out.write("Myrrix Computation Layer");
      out.write("</title>");
      out.write("<style type=\"text/css\">");
      out.write("\nbody {background-color:#202020}\nbody,p,th,td,h1,h2,h3 {font-family:\"Gill Sans\",\"Gill Sans MT\",Helvetica,sans-serif;font-weight:300;color:white}\na {text-decoration:none}\ntable,th,td {border:1px dotted black}\nth,td {padding:5px;white-space:nowrap;vertical-align:top}\ntd {text-align:right}\ntable.layout > tbody > tr > th, table.layout > tbody > tr > td, table.layout {border:0;padding:0;text-align:left}\ntable {border-collapse:collapse}\nform {margin:0;padding:0}\nh1,h2,h3,a {color:#FFBD21}\nh1,h2,h3 {text-transform:uppercase}\nhr {margin:20px 0 10px 0}\ninput {width:70px}\n.meter {padding:0;vertical-align:middle}\n.meter > span {display:block;height:100%;background-color:skyblue;position:relative;overflow:hidden}\n");
      out.write("</style>");
      out.write("<script type=\"text/javascript\">");
      out.write("\nfunction confirmAndPost(formName) {\n  if (confirm(\"Are you sure?\")) {\n    document.forms[formName].submit();\n    return true;\n  } else {\n    return false;\n  }\n}\n");
      out.write("</script>");
      out.write("</head>");
      out.write("<body>");
      out.write("<div style=\"width:800px;margin-left:auto;margin-right:auto;padding:10px\">");
      out.write("<h1>");
      out.write("Myrrix Computation Layer");
      out.write("</h1>");

PeriodicRunner periodicRunner = (PeriodicRunner) application.getAttribute(InitListener.PERIODIC_RUNNER_KEY);
pageContext.setAttribute("periodicRunner", periodicRunner);
pageContext.setAttribute("storeManagementURI", Store.get().getManagementURI());
pageContext.setAttribute("mapredManagementURI", periodicRunner.getState().getManagementURI());

      out.write("<table style=\"width:100%\" class=\"layout\">");
      out.write("<tr>");
      out.write("<td style=\"width:70%\">");
      out.write("<h2>");
      out.write("Configuration");
      out.write("</h2>");
      out.write("<table>");
      out.write("<tr>");
      out.write("<td>");
      out.write("Bucket");
      out.write("</td>");
      out.write("<td style=\"text-align:left\">");
      out.write("<code>");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${periodicRunner.config.bucket}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write("</code>");
      out.write("</td>");
      out.write("<td>");
      out.write("Data Threshold");
      out.write("</td>");
      out.write("<td style=\"text-align:left\">");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${periodicRunner.config.dataThresholdMB}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write(' ');
      out.write('M');
      out.write('B');
      out.write("</td>");
      out.write("</tr>");
      out.write("<tr>");
      out.write("<td>");
      out.write("Instance ID");
      out.write("</td>");
      out.write("<td style=\"text-align:left\">");
      out.write("<code>");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${periodicRunner.config.instanceID}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write("</code>");
      out.write("</td>");
      out.write("<td>");
      out.write("Time Threshold");
      out.write("</td>");
      out.write("<td style=\"text-align:left\">");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${periodicRunner.config.timeThresholdMin}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write(" min");
      out.write("</td>");
      out.write("</tr>");
      out.write("<tr>");
      out.write("<td>");
      out.write("Recommendations?");
      out.write("</td>");
      out.write("<td style=\"text-align:left\">");
      out.write("<code>");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${periodicRunner.config.recommend}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write("</code>");
      out.write("</td>");
      out.write("<td>");
      out.write("Cluster?");
      out.write("</td>");
      out.write("<td style=\"text-align:left\">");
      out.write("<code>");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${periodicRunner.config.cluster}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write("</code>");
      out.write("</td>");
      out.write("</tr>");
      out.write("<tr>");
      out.write("<td>");
      out.write("Item Similarity?");
      out.write("</td>");
      out.write("<td style=\"text-align:left\">");
      out.write("<code>");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${periodicRunner.config.makeItemSimilarity}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write("</code>");
      out.write("</td>");
      out.write("<td colspan=\"2\"/>");
      out.write("</tr>");
      out.write("</table>");
      out.write("</td>");
      out.write("<td style=\"width:30%\">");
      out.write("<h2>");
      out.write("Management");
      out.write("</h2>");
      out.write("<table>");
      out.write("<tr>");
      out.write("<td>");
      out.write("Storage");
      out.write("</td>");
      out.write("<td style=\"text-align:left\">");
      out.write("<a target=\"_blank\" href=\"" + (java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${storeManagementURI}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false) + "\">");
      out.write("Console");
      out.write("</a>");
      out.write("</td>");
      out.write("</tr>");
      out.write("<tr>");
      out.write("<td>");
      out.write("Map Reduce");
      out.write("</td>");
      out.write("<td style=\"text-align:left\">");
      out.write("<a target=\"_blank\" href=\"" + (java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${mapredManagementURI}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false) + "\">");
      out.write("Console");
      out.write("</a>");
      out.write("</td>");
      out.write("</tr>");
      out.write("<tr>");
      out.write("<td>");
      out.write("Myrrix");
      out.write("</td>");
      out.write("<td style=\"text-align:left\">");
      out.write("<a target=\"_blank\" href=\"/log.txt\">");
      out.write("Logs");
      out.write("</a>");
      out.write("</td>");
      out.write("</tr>");
      out.write("</table>");
      out.write("</td>");
      out.write("</tr>");
      out.write("</table>");
      out.write("<hr/>");
      out.write("<h2>");
      out.write("Generations");
      out.write("</h2>");
      out.write("<table style=\"width:100%\">");
      out.write("<tr>");
      out.write("<th>");
      out.write("Name");
      out.write("</th>");
      out.write("<th>");
      out.write("Status");
      out.write("</th>");
      out.write("<th>");
      out.write("Start");
      out.write("</th>");
      out.write("<th style=\"width:50px\">");
      out.write("Map %");
      out.write("</th>");
      out.write("<th style=\"width:50px\">");
      out.write("Reduce %");
      out.write("</th>");
      out.write("<th>");
      out.write('E');
      out.write('n');
      out.write('d');
      out.write("</th>");
      out.write("</tr>");

    PeriodicRunnerState periodicRunnerState = periodicRunner.getState();
    if (!periodicRunnerState.isRunning()) {
      Date nextScheduledRun = periodicRunnerState.getNextScheduledRun();
      pageContext.setAttribute("nextScheduledRun",
                               nextScheduledRun == null ? "" : formatShort(nextScheduledRun));
      pageContext.setAttribute("currentGenerationMB", periodicRunnerState.getCurrentGenerationMB());
  
      out.write("<tr>");
      out.write("<td style=\"background-color:black;text-align:left\" colspan=\"2\">");
      out.write("<span style=\"font-style:italic\">");
      out.write("Next Generation (");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${currentGenerationMB}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write(" MB written)");
      out.write("</span>");
      out.write("\n      &middot;\n      ");
      out.write("<form style=\"display:inline\" method=\"POST\" action=\"/periodicRunner/forceRun\" name=\"periodicRunnerForceRun\">");
      out.write("<a href=\"javascript:confirmAndPost('periodicRunnerForceRun')\">");
      out.write("Force Run");
      out.write("</a>");
      out.write("</form>");
      out.write("</td>");
      out.write("<td style=\"background-color:black;font-style:italic\">");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${nextScheduledRun}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write("</td>");
      out.write("<td style=\"background-color:black\" colspan=\"3\">");
      out.write("&nbsp;");
      out.write("</td>");
      out.write("</tr>");

    }
  

    for (GenerationState generationState : periodicRunner.getState().getGenerationStates()) {
      pageContext.setAttribute("generationState", generationState);
      pageContext.setAttribute("statusHexColor", getHexColor(generationState.getStatus()));
      pageContext.setAttribute("formattedStartDateTime", formatShort(generationState.getStartTime()));
      pageContext.setAttribute("formattedEndDateTime", formatShort(generationState.getEndTime()));
  
      out.write("<tr>");
      out.write("<td style=\"background-color:black;text-align:left\">");
      out.write("<strong>");
      out.write("Generation ");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${generationState.generationID}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write("</strong>");

        if (generationState.isRunning()) {
      
      out.write("\n      &middot;\n      ");
      out.write("<form style=\"display:inline\" method=\"POST\" action=\"/periodicRunner/interrupt\" name=\"periodicRunnerInterrupt\">");
      out.write("<a href=\"javascript:confirmAndPost('periodicRunnerInterrupt')\">");
      out.write("Interrupt");
      out.write("</a>");
      out.write("</form>");

        }
      
      out.write("</td>");
      out.write("<td style=\"" + (java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("background-color:black;text-align:center;color:${statusHexColor}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false) + "\">");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${generationState.status}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write("</td>");
      out.write("<td style=\"background-color:black\">");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${formattedStartDateTime}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write("</td>");
      out.write("<td style=\"background-color:black\" colspan=\"2\">");
      out.write("&nbsp;");
      out.write("</td>");
      out.write("<td style=\"background-color:black\">");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${formattedEndDateTime}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write("</td>");
      out.write("</tr>");

    for (MyrrixStepState stepState : generationState.getStepStates()) {
      pageContext.setAttribute("statusHexColor", getHexColor(stepState.getStatus()));
      pageContext.setAttribute("stepState", stepState);
      pageContext.setAttribute("formattedStartDateTime", formatShort(stepState.getStartTime()));
      pageContext.setAttribute("formattedEndDateTime", formatShort(stepState.getEndTime()));
      URI managementURI = stepState.getManagementURI();
      pageContext.setAttribute("stepManagementURI", managementURI);
      pageContext.setAttribute("mapProgress", formatPercent(stepState.getMapProgress()));
      pageContext.setAttribute("reduceProgress", formatPercent(stepState.getReduceProgress()));
      String stepStateName = stepState.getName();
      pageContext.setAttribute("stepStateName", stepStateName);
  
      out.write("<tr>");
      out.write("<td>");

      if (managementURI == null) {
    
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${stepState.name}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));

      } else {
    
      out.write("<a target=\"_blank\" href=\"" + (java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${stepManagementURI}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false) + "\">");

        if (stepStateName.contains(",")) {
          for (CharSequence name : COMMA.split(stepStateName)) {
            out.append(name).append("<br/>");
          }
        } else {
      
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${stepStateName}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));

        }
      
      out.write("</a>");

      }
    
      out.write("</td>");
      out.write("<td style=\"" + (java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("text-align:center;color:${statusHexColor}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false) + "\">");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${stepState.status}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write("</td>");
      out.write("<td>");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${formattedStartDateTime}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write("</td>");
      out.write("<td class=\"meter\">");
      out.write("<span style=\"" + (java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("width:${mapProgress}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false) + "\">");
      out.write("&nbsp;");
      out.write("</span>");
      out.write("</td>");
      out.write("<td class=\"meter\">");
      out.write("<span style=\"" + (java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("width:${reduceProgress}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false) + "\">");
      out.write("&nbsp;");
      out.write("</span>");
      out.write("</td>");
      out.write("<td>");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${formattedEndDateTime}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write("</td>");
      out.write("</tr>");

      }
    }
  
      out.write("</table>");
      out.write("<p>");
      out.write("&copy; ");
      out.write("<a target=\"_blank\" href=\"http://myrrix.com\">");
      out.write("Myrrix Ltd");
      out.write("</a>");
      out.write(", except for included third-party open source software.\nFull details of licensing at ");
      out.write("<a target=\"_blank\" href=\"http://myrrix.com/legal/\">");
      out.write("http://myrrix.com/legal/");
      out.write("</a>");
      out.write("</p>");
      out.write("</div>");
      out.write("</body>");
      out.write("</html>");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try { out.clearBuffer(); } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
